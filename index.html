<head>
	<style type="text/css">
	.element{
		width:100px;
		height:100px;
		display:inline-block;
	}

	.vert{
		background: #27ae60;
	}

	.bleu{
		background: #3498db;
	}

	.rouge{
		background: #e74c3c;
	}

	.orange{
		background: #f39c12;
	}

	.selected{
		opacity: .7;
	}
	</style>
</head>

<h1>Jeu !</h1>


<div id="game">
	
</div>

<script type="text/javascript">
	var option = [
		'bleu',
		'rouge',
		'vert',
		'orange'
	];

	var actualGame = [];

	var gameSpace = document.getElementById("game");

	var isOneCellSelected = false;


	function startGame() {
		var w = 7;
		var h = 7;

		for (var i = h - 1; i >= 0; i--) {
			ligne = document.createElement("div");
			ligne.setAttribute("id", "ligne"+i);

			var data = "";
			var actualRow = []

			for (var j = h - 1; j >= 0; j--) {

				// On tire la valeur de la case
				var n = Math.floor(Math.random() * option.length);
				var valeur = option[n];
				actualRow.push(valeur);

				data = data+"<div id='cell_"+i+""+j+"' data-pos='"+i+""+j+"' data-val='"+n+"' onmousedown='selectElement("+i+""+j+")' class='element "+valeur+"'>"+valeur+"<br>ligne : "+i+"<br>cellule : "+j+"<br>"+i+""+j+"</div>";
			}

			ligne.innerHTML = data;

			actualGame.push(actualRow);
			gameSpace.appendChild(ligne);
		}
	}

	function selectElement(cellule){
		console.log("On a cliquer sur la cellule "+cellule);


		if (isOneCellSelected == false) {
			document.getElementById("cell_"+cellule).className += " selected";
			isOneCellSelected = true;
		}else{

			var cellulesSelected = document.getElementsByClassName('selected');
			celluleSelected = parseInt(cellulesSelected[0].attributes["data-pos"].value);
			valCellSelected = parseInt(cellulesSelected[0].attributes["data-val"].value);
			valCell = parseInt(document.getElementById("cell_"+cellule).attributes["data-val"].value);

			movementValid = movementValidation(celluleSelected,cellule, valCellSelected, valCell);
			
			if (movementValid == true) {
				console.log("ok");
			}else{
				var elements = document.getElementsByClassName('element');
				for (var i = elements.length - 1; i >= 0; i--) {
					elements[i].classList.remove("selected");
				}
				isOneCellSelected = false;
				selectElement(cellule);
			}
			//isOneCellSelected = true;
		}
		
	}

	function movementValidation(celluleSelected, cellule, valCellSelected, valCell) {
		console.log("La cellule "+celluleSelected+" vaut "+valCellSelected);
		console.log("La cellule "+cellule+" vaut "+valCell);
		if(celluleSelected == cellule-10 || celluleSelected == cellule+10){
			console.log('cas 1');
			console.log('On va tester la cellule '+parseInt(cellule-1)+"("+parseInt(document.getElementById("cell_"+parseInt(cellule-1)).attributes["data-val"].value)+")");
			console.log('On va tester la cellule '+parseInt(cellule+1)+"("+parseInt(document.getElementById("cell_"+parseInt(cellule+1)).attributes["data-val"].value)+")");

			console.log('MAIS AUSSI');
			console.log('On va tester la cellule '+parseInt(celluleSelected-1)+"("+parseInt(document.getElementById("cell_"+parseInt(celluleSelected-1)).attributes["data-val"].value)+")");
			console.log('On va tester la cellule '+parseInt(celluleSelected+1)+"("+parseInt(document.getElementById("cell_"+parseInt(celluleSelected+1)).attributes["data-val"].value)+")");
			return true;
		}else if ((celluleSelected == cellule-1) || (celluleSelected == cellule+1)) {
			return true;
		}else{
			return false;
		}
	}

	startGame();
</script>